# 实现dB值训练的RINN模型

## 项目概述
用户要求采用dB值对RINN模型进行训练，而不是传统的实虚部分离方式，以提高反推效果。

## 主要任务

### 1. 分支管理
- [ ] 创建新分支 `rinn_db_training`
- [ ] 确保分支基于最新的主分支

### 2. 数据处理修改
- [ ] 修改 `trains11RINN.py` 中的 `load_data_from_csv` 函数
  - 从实部和虚部计算S11 dB值
  - 将Y数据维度从202维（101实部+101虚部）改为101维（dB值）
- [ ] 修改数据标准化部分，适应dB值范围

### 3. 模型配置调整
- [ ] 修改 `trains11RINN.py` 中的维度配置
  - 更新 `y_dim` 为101
  - 更新 `padding_dim` 为101
  - 更新 `left_input_dim` 和 `right_input_dim` 为106
- [ ] 调整模型初始化参数，适应新的输入维度

### 4. Z采样策略检查
- [ ] 检查 `trains11RINN.py` 中的Z采样策略
- [ ] 检查 `bayesian_optimization.py` 中的Z采样策略
- [ ] 确保两个文件使用相同的Z采样策略（标准高斯分布）

### 5. 贝叶斯优化
- [ ] 修改 `bayesian_optimization.py`
  - 支持dB值数据加载
  - 调整参数搜索空间
  - 确保Z采样策略与trains11RINN.py一致
  - 运行贝叶斯优化，找到最佳超参数

### 6. 模型训练
- [ ] 使用优化后的参数训练模型
- [ ] 保存训练过程和结果
- [ ] 验证模型性能

### 7. 反推脚本修改
- [ ] 修改 `filter_rinn_transformed.py`
  - 支持dB值输入
  - 调整数据处理流程
  - 使用新训练的模型进行反推

### 8. 结果验证
- [ ] 运行反推脚本，生成结果
- [ ] 分析反推效果
- [ ] 与实虚部训练的结果进行对比

## 技术要点

### 数据处理
- S11 dB值计算：`20 * log10(sqrt(real^2 + imag^2))`
- dB值范围处理：通常在-60到0之间
- 数据标准化：使用robust标准化方法，适应dB值分布

### 模型配置
- 输入维度：左侧(5+101=106)，右侧(101+5=106)
- Affine coupling比率调整：适应新的输入维度
- 损失函数：保持不变，使用加权NMSE和MMD

### Z采样策略
- 标准高斯分布：`np.random.randn()`
- 每个epoch重新采样，增强模型泛化能力
- 确保贝叶斯优化和训练脚本使用相同的采样策略

### 贝叶斯优化
- 参数搜索空间：保持与原配置类似
- 优化目标：验证集NMSE最小化

### 反推流程
- 输入：filter_ideal生成的dB值
- 处理：直接使用dB值作为模型输入
- 输出：重建的几何参数和预测的S11曲线

## 预期结果
- 训练一个基于dB值的RINN模型
- 提高反推效果，生成更准确的几何参数
- 生成可视化结果，展示反推性能

## 注意事项
- 确保Z采样策略在贝叶斯优化和训练脚本中完全一致
- 注意dB值计算的数值稳定性，避免log10(0)的情况
- 调整数据标准化方法，适应dB值的特殊分布
- 验证模型在不同输入范围内的鲁棒性